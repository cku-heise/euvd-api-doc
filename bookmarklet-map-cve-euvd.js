// Bookmarklet to map a CVE ID to a EUVD ID.
// Bookmarklet shamelessly lifted off https://gist.github.com/mvark/65bf25dffc64d3c2ad28a6f4866d3caa
javascript: (function() {
    var text = "";
    if (window.getSelection) {
        text = window.getSelection().toString();
    } else if (document.selection && document.selection.type != "Control") {
        text = document.selection.createRange().text;
    }
    var cvePattern = new RegExp("^(CVE-(1999|2\d{3})-(0\d{2}[0-9]|[1-9]\d{3,}))$");
    var res = cvePattern.test(text);
    if (res) {
        showEUVD(text);
    } else {
        var cve = prompt("Please provide a valid CVE ID");
        showIP(cve);
    }

    function showEUVD(cve) {
        var xhttp = new XMLHttpRequest();
        xhttp.onreadystatechange = function() {
            if (xhttp.readyState == 4 && xhttp.status == 200) {
                var cveDetails = JSON.parse(xhttp.responseText);
                var cveId = "";

              alert(cveDetails);
            }
        };
        xhttp.open("GET", "https://euvdservices.enisa.europa.eu/api/vulnerabilities?text=" + cve, true);
        xhttp.send();
    }
})()
